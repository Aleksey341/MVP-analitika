<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–î–µ–º–æ UX —É–ª—É—á—à–µ–Ω–∏–π - MVP Analitika</title>
  <link rel="stylesheet" href="/no-badge.css" />
  <link rel="stylesheet" href="/assets/dashboard-enhancements.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --bg-primary: #0f1115;
      --bg-secondary: #1a1d24;
      --bg-tertiary: #232a36;
      --border: #2b3444;
      --text-primary: #f3f4f6;
      --text-secondary: #d1d5db;
      --text-muted: #9ca3af;
      --accent-blue: #2563eb;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 20px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 { margin: 0; font-size: 24px; }
    .subtitle { color: var(--text-secondary); font-size: 14px; margin: 4px 0 0 0; }

    main {
      max-width: 1600px;
      margin: 0 auto;
      padding: 24px;
    }

    .section {
      margin-bottom: 48px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .kpi-card {
      background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      transition: transform 0.2s;
    }

    .kpi-card:hover {
      transform: translateY(-4px);
    }

    .kpi-icon { font-size: 32px; margin-bottom: 12px; }
    .kpi-label {
      color: var(--text-secondary);
      font-size: 13px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }
    .kpi-value {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .kpi-change {
      font-size: 14px;
      font-weight: 600;
    }
    .kpi-change.positive { color: var(--success); }
    .kpi-change.negative { color: var(--danger); }

    .btn {
      padding: 10px 20px;
      background: var(--accent-blue);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
    }

    .chart-container {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }

    #insights-section {
      margin-top: 40px;
    }
  </style>
</head>
<body>

<header>
  <div class="header-content">
    <div>
      <h1>üé® –î–µ–º–æ UX —É–ª—É—á—à–µ–Ω–∏–π</h1>
      <p class="subtitle">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–∞—à–±–æ—Ä–¥–∞ MVP-Analitika</p>
    </div>
    <div id="export-container"></div>
  </div>
</header>

<main>

  <!-- Preset Filters -->
  <div class="section">
    <h2 class="section-title">üéØ –ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã</h2>
    <div id="preset-filters-container"></div>
  </div>

  <!-- KPI Cards with Indicators -->
  <div class="section">
    <h2 class="section-title">üìä KPI —Å —Ü–≤–µ—Ç–æ–≤—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏</h2>
    <p style="color: var(--text-secondary); margin-bottom: 20px;">
      –ö–∞—Ä—Ç–æ—á–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–∫—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
    </p>
    <div class="kpi-grid" id="kpi-grid">
      <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>
  </div>

  <!-- Animated Counters -->
  <div class="section">
    <h2 class="section-title">‚ú® –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏</h2>
    <p style="color: var(--text-secondary); margin-bottom: 20px;">
      –ß–∏—Å–ª–∞ –ø–ª–∞–≤–Ω–æ –∞–Ω–∏–º–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
    </p>
    <div style="background: var(--bg-secondary); padding: 30px; border-radius: 12px; text-align: center;">
      <div style="font-size: 48px; font-weight: 700; color: var(--accent-blue);" id="animated-counter">0</div>
      <button class="btn" onclick="updateCounter()" style="margin-top: 20px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</button>
    </div>
  </div>

  <!-- Auto Insights -->
  <div class="section" id="insights-section">
    <h2 class="section-title">üí° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å–∞–π—Ç—ã</h2>
    <p style="color: var(--text-secondary); margin-bottom: 20px;">
      –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –≤—ã—è–≤–ª—è–µ—Ç –≤–∞–∂–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã
    </p>
    <div id="insights-container"></div>
  </div>

  <!-- Sample Chart -->
  <div class="section">
    <h2 class="section-title">üìà –ì—Ä–∞—Ñ–∏–∫ —Å –¥–∞–Ω–Ω—ã–º–∏</h2>
    <div class="chart-container">
      <canvas id="sample-chart"></canvas>
    </div>
  </div>

  <!-- Tour Button -->
  <div class="section" style="text-align: center;">
    <button class="btn" onclick="startTour()" style="padding: 15px 30px; font-size: 16px;">
      üéì –ù–∞—á–∞—Ç—å –æ–±—É—á–∞—é—â–∏–π —Ç—É—Ä
    </button>
  </div>

</main>

<script src="/assets/dashboard-enhancements.js"></script>
<script>
const { KPIIndicator, AnimatedCounter, URLFilters, PresetFilters, InsightsEngine, PDFExporter, OnboardingTour } = window.DashboardEnhancements;

// ========================================
// 1. KPI CARDS
// ========================================

const kpiData = [
  {
    icon: 'üöó',
    label: '–î–¢–ü –∑–∞ –º–µ—Å—è—Ü',
    value: 234,
    change: -12.5,
    thresholds: { critical: 300, warning: 250, good: 200 }
  },
  {
    icon: 'üíÄ',
    label: '–ü–æ–≥–∏–±—à–∏—Ö',
    value: 8,
    change: -25,
    thresholds: { critical: 15, warning: 10, good: 5 }
  },
  {
    icon: 'üè•',
    label: '–†–∞–Ω–µ–Ω—ã—Ö',
    value: 156,
    change: -8.3,
    thresholds: { critical: 200, warning: 150, good: 100 }
  },
  {
    icon: 'üìä',
    label: '–£—Å–ª—É–≥ –æ–∫–∞–∑–∞–Ω–æ',
    value: 12458,
    change: 15.2,
    thresholds: { critical: 8000, warning: 10000, good: 12000 }
  }
];

function renderKPI() {
  const grid = document.getElementById('kpi-grid');

  kpiData.forEach(kpi => {
    const card = document.createElement('div');
    card.className = 'kpi-card';

    card.innerHTML = `
      <div class="kpi-icon">${kpi.icon}</div>
      <div class="kpi-label">${kpi.label}</div>
      <div class="kpi-value">${kpi.value.toLocaleString()}</div>
      <div class="kpi-change ${kpi.change > 0 ? 'positive' : 'negative'}">
        ${kpi.change > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(kpi.change)}%
      </div>
    `;

    grid.appendChild(card);

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞
    const status = KPIIndicator.enhance(card, kpi.value, kpi.thresholds);
    card.dataset.status = status;
  });
}

// ========================================
// 2. ANIMATED COUNTER
// ========================================

let counterValue = 0;

function updateCounter() {
  const newValue = Math.floor(Math.random() * 50000) + 10000;
  const element = document.getElementById('animated-counter');

  AnimatedCounter.animate(element, counterValue, newValue, 1500);
  counterValue = newValue;
}

// ========================================
// 3. PRESET FILTERS
// ========================================

PresetFilters.renderPresets('#preset-filters-container', (preset) => {
  console.log('–í—ã–±—Ä–∞–Ω preset:', preset);

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ URL
  URLFilters.save({
    year: preset.year,
    month: preset.month,
    quarter: preset.quarter
  });

  alert(`–§–∏–ª—å—Ç—Ä –ø—Ä–∏–º–µ–Ω—ë–Ω: ${preset.name}\n–ì–æ–¥: ${preset.year}${preset.month ? ', –ú–µ—Å—è—Ü: ' + preset.month : ''}`);
});

// ========================================
// 4. AUTO INSIGHTS
// ========================================

function generateInsights() {
  // –°–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
  const timeseries = Array.from({ length: 12 }, (_, i) => ({
    label: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω', '–ò—é–ª', '–ê–≤–≥', '–°–µ–Ω', '–û–∫—Ç', '–ù–æ—è', '–î–µ–∫'][i],
    value: Math.floor(Math.random() * 100) + 150
  }));

  // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–æ–º–∞–ª–∏—é –≤ –º–∞–µ
  timeseries[4].value = 350;

  const data = {
    current: 234,
    previous: 280,
    timeseries: timeseries,
    rankings: [
      { name: '–õ–∏–ø–µ—Ü–∫', value: 89 },
      { name: '–ï–ª–µ—Ü', value: 45 },
      { name: '–ì—Ä—è–∑–∏', value: 23 },
      { name: '–î–∞–Ω–∫–æ–≤', value: 12 }
    ]
  };

  const insights = InsightsEngine.analyze(data);
  InsightsEngine.render(insights, '#insights-container');
}

// ========================================
// 5. SAMPLE CHART
// ========================================

function renderChart() {
  const ctx = document.getElementById('sample-chart').getContext('2d');

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω', '–ò—é–ª', '–ê–≤–≥', '–°–µ–Ω', '–û–∫—Ç', '–ù–æ—è', '–î–µ–∫'],
      datasets: [{
        label: '–î–¢–ü',
        data: [220, 215, 230, 210, 350, 225, 205, 240, 218, 235, 228, 234],
        borderColor: '#ef4444',
        backgroundColor: 'rgba(239, 68, 68, 0.1)',
        fill: true,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: { color: '#f3f4f6' }
        }
      },
      scales: {
        x: {
          grid: { color: '#2b3444' },
          ticks: { color: '#d1d5db' }
        },
        y: {
          grid: { color: '#2b3444' },
          ticks: { color: '#d1d5db' }
        }
      }
    }
  });
}

// ========================================
// 6. PDF EXPORT
// ========================================

PDFExporter.addExportButton('#export-container');

// ========================================
// 7. ONBOARDING TOUR
// ========================================

function startTour() {
  const tour = new OnboardingTour([
    {
      selector: '#preset-filters-container',
      title: '–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã',
      text: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞: —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü, –∫–≤–∞—Ä—Ç–∞–ª, –ø–æ–ª–≥–æ–¥–∞.'
    },
    {
      selector: '.kpi-grid',
      title: 'KPI —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏',
      text: '–ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–∫—Ä–∞—à–∏–≤–∞—é—Ç—Å—è: üü¢ –Ω–æ—Ä–º–∞, üü° –≤–Ω–∏–º–∞–Ω–∏–µ, üî¥ –∫—Ä–∏—Ç–∏—á–Ω–æ.'
    },
    {
      selector: '#insights-container',
      title: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å–∞–π—Ç—ã',
      text: '–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—è–≤–ª—è–µ—Ç –≤–∞–∂–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã, –∞–Ω–æ–º–∞–ª–∏–∏ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã.'
    },
    {
      selector: '#export-container',
      title: '–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤',
      text: '–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ –≤ PDF —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö.'
    }
  ]);

  window.tour = tour;
  tour.start();
}

// ========================================
// INIT
// ========================================

document.addEventListener('DOMContentLoaded', () => {
  renderKPI();
  generateInsights();
  renderChart();

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç —Ç—É—Ä–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  if (!localStorage.getItem('tour_completed')) {
    setTimeout(startTour, 1000);
  }

  // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞
  setTimeout(() => {
    updateCounter();
  }, 500);
});

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ URL
const savedFilters = URLFilters.load();
if (Object.keys(savedFilters).length > 0) {
  console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ URL:', savedFilters);
}
</script>

</body>
</html>
