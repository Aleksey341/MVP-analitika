#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±–ª–æ–∫–∞ "–ü—Ä–æ–µ–∫—Ç—ã"
# –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é –ë–î –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ

set -e

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ '–ü—Ä–æ–µ–∫—Ç—ã'..."

# 1. –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
echo ""
echo "üìä –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –ë–î..."
psql $DATABASE_URL -f database/projects-migration.sql

if [ $? -eq 0 ]; then
  echo "‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞"
else
  echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î"
  exit 1
fi

# 2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
echo ""
echo "üì¶ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–æ–≤..."
node scripts/import-projects-data.js

if [ $? -eq 0 ]; then
  echo "‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã"
else
  echo "‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö"
  exit 1
fi

echo ""
echo "‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!"
echo ""
echo "üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:"
echo "  - –°–æ–∑–¥–∞–Ω—ã —Ç–∞–±–ª–∏—Ü—ã: projects_catalog, projects_items, projects_data"
echo "  - –î–æ–±–∞–≤–ª–µ–Ω–æ 5 –ø–æ–¥–±–ª–æ–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤"
echo "  - –î–æ–±–∞–≤–ª–µ–Ω–æ 31 –ø—Ä–æ–µ–∫—Ç"
echo "  - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –∑–∞ —Å–µ–Ω—Ç—è–±—Ä—å 2025"
echo ""
echo "üåê –ë–ª–æ–∫ '–ü—Ä–æ–µ–∫—Ç—ã' –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –¥–∞—à–±–æ—Ä–¥–µ –ø–æ –∞–¥—Ä–µ—Å—É:"
echo "   https://mvp-analitika-alex1976.amvera.io/dashboard"
